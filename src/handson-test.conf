server {
    listen 80;
    server_name _;

    root /etc/nginx/conf.d/handson-test-html;
    index index.html;
    
    location / {
        # HTML内の各プレースホルダーを動的な値に置換
        sub_filter 'CL-ADDRESS' '$remote_addr';
        sub_filter 'SV-HOSTNAME' '$hostname';
        sub_filter 'SV-ADDRESS' '$server_addr';
        # 複数のsub_filterを有効にするためoffに設定
        sub_filter_once off;
    }

    # 400エラーテスト用のロケーション
    location = /test400 {
        return 400;
    }

    # 401エラーテスト用のロケーション
    location = /test401 {
        return 401;
    }

    # 403エラーテスト用のロケーション
    location = /test403 {
        return 403;
    }
    
    # 404エラーテスト用のロケーション
    location = /test404 {
        return 404;
    }

    # 500エラーテスト用のロケーション
    location = /test500 {
        return 500;
    }

    # 502エラーテスト用のロケーション
    location = /test502 {
        return 502;
    }

    # 503エラーテスト用のロケーション
    location = /test503 {
        return 503;
    }
    
    # 504エラーテスト用のロケーション
    location = /test504 {
        return 504;
    }

    # エラーページ設定
    error_page 400 401 403 404 /error_handler;
    error_page 500 502 503 504 /error_handler;

    # エラーハンドリング用の内部ロケーション
    location = /error_handler {
        internal;
        rewrite ^ /error.html?status=$status break;
    }
}